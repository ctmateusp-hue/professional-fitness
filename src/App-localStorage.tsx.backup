import { useState, useEffect } from 'react'
import { Header } from './components/Header'  if (currentView === 'admin') {
    return (
      <div className="min-h-screen bg-background">
        <AdminPanel 
          onBack={(openGallery) => {
            if (openGallery) {
              setSelectedModalityId(openGallery.modalityId)
              setCurrentView('gallery')
            } else {
              setCurrentView('home')
            }
          }}
          modalities={modalities}
        />
        <Toaster />
      </div>
    )
  }m './components/Hero'
import { ModalityCards } from './components/ModalityCards'
import { Gallery } from './components/Gallery'
import { Pricing } from './components/Pricing'
import { Contact } from './components/Contact'
import { Footer } from './components/Footer'
import { AdminPanel } from './components/AdminPanel'
import { Toaster } from '@/components/ui/sonner'
import whatsappIcon from './assets/whatsapp.png'

const WHATSAPP_LINK = "https://wa.me/5517988275111?text=Quero%20agendar%20uma%20aula%20experimental";

export type Modality = {
  id: string
  title: string
  description: string
  image?: string
}

export type MediaItem = {
  id: string
  modalityId: string
  type: 'image' | 'video'
  url: string
  title: string
  description?: string
  thumbnail?: string
}

const defaultModalities: Modality[] = [
  {
    id: 'functional',
    title: 'FUNCIONAL/CROSS',
    description: 'Nossos treinos são elaborados com uma metodologia própria. Voltado para as pessoas da nossa cidade. São exercícios que usam bastante o peso corporal associados com aparelhos de musculação.'
  },
  {
    id: 'musculacao',
    title: 'MUSCULAÇÃO',
    description: 'Treinos elaborados com exercícios de resultado, ou seja, focando no que o corpo mais precisa, tanto para estética, fortalecimento, ganho de massa….etc.'
  },
  {
    id: 'zumba',
    title: 'ZUMBA',
    description: 'Aula de dança com as melhores e mais animadas músicas! Coreografias adaptadas para você aproveitar o máximo a aula!'
  }
]

// Custom hook para substituir useKV usando localStorage
function useLocalStorage<T>(key: string, defaultValue: T): [T, (value: T | ((prev: T) => T)) => void] {
  const [state, setState] = useState<T>(() => {
    try {
      const item = window.localStorage.getItem(key)
      return item ? JSON.parse(item) : defaultValue
    } catch (error) {
      console.warn(`Error reading localStorage key "${key}":`, error)
      return defaultValue
    }
  })

  const setValue = (value: T | ((prev: T) => T)) => {
    try {
      const valueToStore = value instanceof Function ? value(state) : value
      setState(valueToStore)
      window.localStorage.setItem(key, JSON.stringify(valueToStore))
    } catch (error) {
      console.warn(`Error setting localStorage key "${key}":`, error)
    }
  }

  return [state, setValue]
}

function App() {
  const [currentView, setCurrentView] = useState<'home' | 'admin'>('home')
  const [isAdmin, setIsAdmin] = useState(false)
  const [modalities] = useLocalStorage<Modality[]>('gym-modalities', defaultModalities)
  const [media] = useLocalStorage<MediaItem[]>('gym-media', [])
  const [selectedModalityId, setSelectedModalityId] = useState<string | null>(null)

  const selectedModality = modalities?.find(m => m.id === selectedModalityId)

  const handleBackFromAdmin = (openGallery?: { modalityId: string }) => {
    setCurrentView('home')
    if (openGallery) {
      setSelectedModalityId(openGallery.modalityId)
    }
  }

  if (currentView === 'admin') {
    return (
      <div className="min-h-screen bg-background">
        <div className="max-w-4xl mx-auto p-8">
          <button 
            onClick={() => setCurrentView('home')}
            className="mb-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
          >
            ← Voltar ao Site
          </button>
          <h1 className="text-3xl font-bold mb-4">Painel Administrativo</h1>
          <p className="text-gray-600">
            Funcionalidade do admin será implementada em uma próxima versão.
            Por enquanto, você pode voltar ao site principal.
          </p>
        </div>
        <Toaster />
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-background">
      <Header 
        onAdminClick={() => setCurrentView('admin')}
        isAdmin={isAdmin}
        onAdminLogin={() => setIsAdmin(true)}
      />
      
      <main>
        <Hero />
        <ModalityCards 
          modalities={modalities || []}
          onModalityClick={(modalityId) => setSelectedModalityId(modalityId)}
        />
        <Pricing />
        <Contact />
      </main>
      
      <Footer />
      
      {selectedModality && (
        <Gallery
          modality={selectedModality}
          media={(media || []).filter(m => m.modalityId === selectedModality.id)}
          onClose={() => setSelectedModalityId(null)}
        />
      )}
      
      <Toaster />
    </div>
  )
}

export default App
